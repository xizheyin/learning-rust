<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>New for Rust</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">New for Rust</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="第一章rust语言背景与发展"><a class="header" href="#第一章rust语言背景与发展">第一章：Rust语言背景与发展</a></h1>
<h2 id="11-计算机语言发展简史"><a class="header" href="#11-计算机语言发展简史">1.1 计算机语言发展简史</a></h2>
<p>在正式学习Rust之前，我们先来回顾一下计算机编程语言的发展历程。C语言自1972年诞生以来，凭借其高效、灵活和接近底层的特性，成为了系统级开发的事实标准。此后，C++、Java、Python、Go等语言相继出现，各自针对不同的应用场景和开发需求进行了优化。</p>
<p>然而，随着软件系统的复杂度不断提升，传统语言在安全性、并发性和可维护性方面逐渐暴露出一些问题。例如，C/C++容易出现内存泄漏、野指针、数据竞争等难以排查的bug。为了解决这些问题，Rust应运而生。</p>
<h2 id="12-rust的诞生背景与设计目标"><a class="header" href="#12-rust的诞生背景与设计目标">1.2 Rust的诞生背景与设计目标</a></h2>
<p>Rust最初由Mozilla工程师Graydon Hoare于2010年发起，目标是打造一种既能像C/C++一样高效，又能最大程度保证安全性的系统级编程语言。Rust的核心设计理念包括：</p>
<ul>
<li><strong>内存安全</strong>：通过所有权（Ownership）和借用（Borrowing）机制，杜绝野指针、悬垂引用等问题。</li>
<li><strong>并发安全</strong>：在编译期防止数据竞争，提升多线程编程的可靠性。</li>
<li><strong>高性能</strong>：零成本抽象，性能媲美C/C++。</li>
<li><strong>现代化工具链</strong>：内置包管理、构建、测试和文档生成工具，提升开发效率。</li>
</ul>
<h2 id="13-rust与cc的对比"><a class="header" href="#13-rust与cc的对比">1.3 Rust与C/C++的对比</a></h2>
<div class="table-wrapper"><table><thead><tr><th>特性</th><th>C/C++</th><th>Rust</th></tr></thead><tbody>
<tr><td>内存管理</td><td>手动/RAII</td><td>所有权+借用+生命周期</td></tr>
<tr><td>并发安全</td><td>需开发者自行保证</td><td>编译器静态检查，防止数据竞争</td></tr>
<tr><td>错误处理</td><td>返回码/异常</td><td>Result/Option类型</td></tr>
<tr><td>包管理</td><td>无统一标准</td><td>cargo一站式解决</td></tr>
<tr><td>生态</td><td>成熟，历史悠久</td><td>新兴，发展迅速</td></tr>
</tbody></table>
</div>
<p>Rust并不是要取代C/C++，而是为系统级开发提供一种更安全、更现代的选择。</p>
<h2 id="14-rust的实际应用与生态"><a class="header" href="#14-rust的实际应用与生态">1.4 Rust的实际应用与生态</a></h2>
<p>目前，Rust已被广泛应用于浏览器（如Firefox的Servo引擎）、区块链、云计算、嵌入式开发等领域。许多知名企业（如微软、亚马逊、谷歌等）都在积极采用Rust来提升产品的安全性和性能。</p>
<p>Rust社区活跃，生态丰富。crates.io上有大量高质量的第三方库，极大地提升了开发效率。</p>
<h2 id="15-安装rust开发环境"><a class="header" href="#15-安装rust开发环境">1.5 安装Rust开发环境</a></h2>
<p>下面我们来动手安装Rust开发环境，并编写第一个Rust程序。</p>
<h3 id="151-安装rust"><a class="header" href="#151-安装rust">1.5.1 安装Rust</a></h3>
<p>在Linux/macOS终端或Windows的WSL中，执行以下命令：</p>
<pre><code class="language-bash">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
</code></pre>
<p>根据提示完成安装后，重启终端，输入：</p>
<pre><code class="language-bash">rustc --version
cargo --version
</code></pre>
<p>如果能看到版本号，说明安装成功。</p>
<h3 id="152-配置vscode插件"><a class="header" href="#152-配置vscode插件">1.5.2 配置VSCode插件</a></h3>
<p>推荐安装"rust-analyzer"插件，获得更好的代码补全和语法提示体验。</p>
<h3 id="153-创建第一个rust项目"><a class="header" href="#153-创建第一个rust项目">1.5.3 创建第一个Rust项目</a></h3>
<p>使用cargo新建项目：</p>
<pre><code class="language-bash">cargo new hello_rust
cd hello_rust
cargo run
</code></pre>
<p>你会看到输出：</p>
<pre><code>Hello, world!
</code></pre>
<h4 id="代码示例"><a class="header" href="#代码示例">代码示例</a></h4>
<p><code>src/main.rs</code> 文件内容如下：</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    println!("Hello, world!");
}</code></pre></pre>
<p>是不是很熟悉？和C语言的<code>printf</code>类似，但Rust的<code>println!</code>是一个宏，后续我们会详细讲解。</p>
<h2 id="16-小结与思考题"><a class="header" href="#16-小结与思考题">1.6 小结与思考题</a></h2>
<p>本章我们回顾了编程语言的发展，了解了Rust的诞生背景、设计目标和核心优势，并完成了开发环境的安装和第一个程序的编写。Rust以其独特的安全性和高性能，正在成为越来越多企业的首选。</p>
<h3 id="思考题"><a class="header" href="#思考题">思考题</a></h3>
<ol>
<li>你认为C语言在现代开发中最大的优势和劣势分别是什么？</li>
<li>Rust的所有权机制能解决哪些C语言常见的bug？</li>
<li>试着用C语言写一个"Hello, world!"程序，并与Rust的版本进行对比，有哪些异同？</li>
</ol>
<h2 id="17-计算机基础回顾与rust的定位"><a class="header" href="#17-计算机基础回顾与rust的定位">1.7 计算机基础回顾与Rust的定位</a></h2>
<h3 id="171-程序的编译与执行流程"><a class="header" href="#171-程序的编译与执行流程">1.7.1 程序的编译与执行流程</a></h3>
<p>在C语言中，源代码（.c）会经过预处理、编译、链接等多个阶段，最终生成可执行文件。Rust的编译流程与C类似，但Rust的编译器（rustc）会在编译阶段做更严格的静态检查，帮助开发者提前发现潜在的内存和并发问题。</p>
<div class="table-wrapper"><table><thead><tr><th>阶段</th><th>C语言</th><th>Rust语言</th></tr></thead><tbody>
<tr><td>预处理</td><td>#include/#define等</td><td>宏展开</td></tr>
<tr><td>编译</td><td>生成目标文件（.o）</td><td>生成目标文件（.o）</td></tr>
<tr><td>链接</td><td>生成可执行文件</td><td>生成可执行文件</td></tr>
<tr><td>运行</td><td>操作系统加载执行</td><td>操作系统加载执行</td></tr>
</tbody></table>
</div>
<p>Rust同样属于"静态编译型语言"，无需虚拟机，直接生成本地可执行文件，运行效率极高。</p>
<h3 id="172-静态类型与动态类型"><a class="header" href="#172-静态类型与动态类型">1.7.2 静态类型与动态类型</a></h3>
<ul>
<li><strong>静态类型</strong>（如C、Rust）：变量类型在编译期确定，运行效率高，出错早发现。</li>
<li><strong>动态类型</strong>（如Python、JavaScript）：变量类型在运行期确定，灵活但易出错。</li>
</ul>
<p>Rust和C一样属于静态类型语言，但Rust支持类型推断，代码更简洁。例如：</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 42; // Rust会自动推断x为i32类型
<span class="boring">}</span></code></pre></pre>
<h3 id="173-内存管理方式的演变深入讲解"><a class="header" href="#173-内存管理方式的演变深入讲解">1.7.3 内存管理方式的演变（深入讲解）</a></h3>
<p>在C语言中，内存管理完全依赖开发者手动操作。比如：</p>
<pre><code class="language-c">// C语言：手动分配和释放内存
int* p = (int*)malloc(sizeof(int));
*p = 42;
free(p); // 如果忘记free，就会内存泄漏
</code></pre>
<h4 id="什么是野指针"><a class="header" href="#什么是野指针">什么是"野指针"？</a></h4>
<p>野指针指的是指向已经被释放或未初始化内存的指针。比如：</p>
<pre><code class="language-c">int* p = (int*)malloc(sizeof(int));
free(p);
*p = 10; // 此时p已经是野指针，操作会导致未定义行为
</code></pre>
<p>这种错误在C/C++中很常见，可能导致程序崩溃甚至安全漏洞。</p>
<h4 id="rust如何避免野指针"><a class="header" href="#rust如何避免野指针">Rust如何避免野指针？</a></h4>
<p>Rust通过所有权和生命周期机制，保证变量离开作用域时自动释放内存，且禁止悬垂引用：</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{
    let x = Box::new(42);
    // x在这里有效
} // 这里x自动释放，之后无法再访问x
// println!("{}", x); // 编译报错：x已被释放
<span class="boring">}</span></code></pre></pre>
<p>Rust编译器会在编译期阻止所有悬垂指针和野指针的出现。</p>
<h4 id="什么是内存泄漏"><a class="header" href="#什么是内存泄漏">什么是"内存泄漏"？</a></h4>
<p>内存泄漏是指程序分配了内存但没有释放，导致内存资源被长期占用。例如：</p>
<pre><code class="language-c">void leak() {
    int* p = (int*)malloc(100);
    // 忘记free(p);
}
</code></pre>
<p>C/C++中这种问题很难彻底避免。</p>
<p>Rust的所有权机制让资源自动释放，极大降低了内存泄漏的风险。</p>
<hr />
<h3 id="174-栈与堆的基础知识结合c与rust对比"><a class="header" href="#174-栈与堆的基础知识结合c与rust对比">1.7.4 栈与堆的基础知识（结合C与Rust对比）</a></h3>
<ul>
<li><strong>栈</strong>：像快递员送快递，先进后出，速度快，但空间有限。</li>
<li><strong>堆</strong>：像仓库，随时存取，但需要自己记得取回，否则会堆积成"垃圾"。</li>
</ul>
<h4 id="c语言中的栈与堆"><a class="header" href="#c语言中的栈与堆">C语言中的栈与堆</a></h4>
<pre><code class="language-c">void foo() {
    int a = 10;      // 栈分配，foo结束自动释放
    int* p = malloc(sizeof(int)); // 堆分配，需要手动free
    *p = 20;
    // ...
    free(p);         // 忘记就会泄漏
}
</code></pre>
<h4 id="rust中的栈与堆"><a class="header" href="#rust中的栈与堆">Rust中的栈与堆</a></h4>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo() {
    let a = 10;           // 栈分配，自动释放
    let p = Box::new(20); // 堆分配，离开作用域自动释放
    // ...
} // 这里p和a都被自动释放，无需手动管理
<span class="boring">}</span></code></pre></pre>
<p>Rust的所有权和生命周期机制让你不用再担心"仓库忘记清理"的问题。</p>
<hr />
<h3 id="175-指针引用与数据竞争重点对比与举例"><a class="header" href="#175-指针引用与数据竞争重点对比与举例">1.7.5 指针、引用与数据竞争（重点对比与举例）</a></h3>
<h4 id="c语言的指针与常见问题"><a class="header" href="#c语言的指针与常见问题">C语言的指针与常见问题</a></h4>
<ul>
<li><strong>野指针</strong>：指向无效内存。</li>
<li><strong>悬垂指针</strong>：指向已释放的内存。</li>
<li><strong>数据竞争</strong>：多线程同时读写同一内存，导致结果不可预测。</li>
</ul>
<pre><code class="language-c">// C语言多线程数据竞争示例（伪代码）
int counter = 0;
void* thread_func(void*) {
    for (int i = 0; i &lt; 10000; ++i) {
        counter++; // 多线程下可能出现数据竞争
    }
}
</code></pre>
<p>如果两个线程同时修改counter，可能导致最终结果错误。</p>
<h4 id="rust如何防止数据竞争"><a class="header" href="#rust如何防止数据竞争">Rust如何防止数据竞争？</a></h4>
<p>Rust在编译期就会检查多线程共享变量的可变性和所有权，防止数据竞争：</p>
<pre><pre class="playground"><code class="language-rust">use std::thread;
use std::sync::{Arc, Mutex};

fn main() {
    let counter = Arc::new(Mutex::new(0));
    let mut handles = vec![];
    for _ in 0..2 {
        let counter = Arc::clone(&amp;counter);
        let handle = thread::spawn(move || {
            for _ in 0..10000 {
                let mut num = counter.lock().unwrap();
                *num += 1;
            }
        });
        handles.push(handle);
    }
    for handle in handles {
        handle.join().unwrap();
    }
    println!("结果: {}", *counter.lock().unwrap());
}</code></pre></pre>
<p>Rust强制你用Arc（原子引用计数）和Mutex（互斥锁）来保证多线程安全，编译器会阻止不安全的并发代码。</p>
<h4 id="rust的引用安全"><a class="header" href="#rust的引用安全">Rust的引用安全</a></h4>
<p>Rust区分可变引用（&amp;mut T）和不可变引用（&amp;T），同一时间只能有一个可变引用或多个不可变引用，杜绝了数据竞争和悬垂引用。</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut x = 5;
let y = &amp;mut x;
*y += 1;
// let z = &amp;x; // 编译报错：不能同时有可变和不可变引用
<span class="boring">}</span></code></pre></pre>
<p>这种严格的规则虽然一开始不太习惯，但极大提升了代码的安全性。</p>
<hr />
<h2 id="18-工程实践与团队协作初体验"><a class="header" href="#18-工程实践与团队协作初体验">1.8 工程实践与团队协作初体验</a></h2>
<p>Rust自带包管理和构建工具（cargo），新建、编译、测试、依赖管理一站式完成。推荐团队统一使用rustfmt（代码格式化）、clippy（代码静态检查），保证代码风格一致、质量可控。</p>
<ul>
<li><strong>文档注释</strong>：使用<code>///</code>为函数和模块添加文档注释。</li>
<li><strong>自动生成文档</strong>：<code>cargo doc --open</code>可以生成并打开项目文档。</li>
<li><strong>单元测试</strong>：Rust内置测试框架，<code>cargo test</code>一键运行所有测试。</li>
</ul>
<p>这些工具和规范，有助于团队协作和代码维护。</p>
<hr />
<h2 id="19-常见问题解答"><a class="header" href="#19-常见问题解答">1.9 常见问题解答</a></h2>
<ul>
<li><strong>Rust为什么没有GC？</strong>
Rust通过所有权和生命周期机制，在编译期自动管理内存，无需运行时GC，既安全又高效。</li>
<li><strong>Rust和C++的RAII有什么不同？</strong>
Rust的所有权和借用机制更严格，能在编译期发现更多潜在问题，C++的RAII主要依赖开发者自律。</li>
<li><strong>Rust适合哪些项目？</strong>
适合对安全性、性能要求高的系统级开发，如操作系统、嵌入式、Web后端、高性能服务等。</li>
<li><strong>哪些场景下不建议用Rust？</strong>
对开发效率要求极高、生态依赖特定语言的快速原型开发，可能更适合用动态语言。</li>
</ul>
<hr />
<h2 id="110-拓展阅读与社区资源"><a class="header" href="#110-拓展阅读与社区资源">1.10 拓展阅读与社区资源</a></h2>
<ul>
<li><a href="https://www.rust-lang.org/zh-CN/learn">Rust官方文档</a></li>
<li><a href="https://doc.rust-lang.org/rust-by-example/">Rust by Example</a></li>
<li><a href="https://github.com/rust-unofficial/awesome-rust">Awesome Rust</a></li>
<li><a href="https://rustcc.cn/">Rust中文社区</a></li>
</ul>
<p>鼓励大家多参与社区讨论、提问和贡献代码，持续学习、共同进步！</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
